<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Maxy Status</title>
  <style>
    body { background:#0d0d0d; color:white; font-family:Arial; text-align:center; padding:40px; }
    #status { font-size:28px; margin-bottom:10px; }
    #time { color:#bbb; margin-bottom:10px; }
    #uptime { margin:20px 0; }
    canvas { background:#111; display:block; margin: 20px auto; border-radius:6px; }
  </style>
</head>
<body>
  <h1>Maxy Status</h1>
  <div id="status">Loading…</div>
  <div id="time"></div>
  <div id="uptime"></div>
  <canvas id="chart" width="900" height="300"></canvas>

<script>
async function fetchStatus() {
  const res = await fetch("/status.json");
  return res.json();
}
async function fetchMonthly() {
  const res = await fetch("/monthly.json");
  return res.json();
}
function formatSince(ts){
  if(!ts) return "";
  const s = Math.floor((Date.now()-ts)/1000);
  if (s < 60) return s+"s";
  if (s < 3600) return Math.floor(s/60)+"m "+(s%60)+"s";
  return Math.floor(s/3600)+"h "+Math.floor((s%3600)/60)+"m";
}

async function draw(){
  const st = await fetchStatus();
  const map = { online: "✅ Online", down: "❌ Down" };
  document.getElementById("status").innerText = map[st.status] || st.status;
  document.getElementById("time").innerText = st.lastDown ? ("Down since: "+new Date(st.lastDown).toLocaleString()+" ("+formatSince(st.lastDown)+")") : "";
  document.getElementById("uptime").innerText = `Uptime: ${st.uptime24h}% (24h) • ${st.uptime7d}% (7d)`;

  const months = await fetchMonthly();
  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const barW = Math.floor((canvas.width - 40) / months.length) - 4;
  months.forEach((d,i)=>{
    const x = 20 + i*(barW+4);
    const h = (d.uptime/100) * (canvas.height - 40);
    ctx.fillStyle = d.uptime >= 99 ? "#4caf50" : (d.uptime >= 95 ? "#ffb300" : "#f44336");
    ctx.fillRect(x, canvas.height - 20 - h, barW, h);
    ctx.fillStyle = "#ccc";
    ctx.font = "12px Arial";
    ctx.fillText(d.day.slice(5), x, canvas.height - 5);
  });
}

draw();
setInterval(draw, 10000);
</script>
</body>
</html>
