<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Maxy Status</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--bg:#071017;--card:#0b1720;--muted:#9aa7b4;--green:#39d353;--red:#ff4d4f;--yellow:#ffbf47;--blue:#5ab0ff;--purple:#c07bff}
body{font-family:Inter,Arial;background:linear-gradient(180deg,#031018 0%,#071017 100%);color:#e8f0f2;margin:0;padding:24px;display:flex;flex-direction:column;align-items:center}
.container{width:100%;max-width:1100px}
.statusCard{display:flex;align-items:center;gap:16px;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);width:100%}
.pulse{width:18px;height:18px;border-radius:50%;position:relative}
.pulse::after{content:'';position:absolute;inset:0;border-radius:50%;animation:pulse 1.8s infinite ease-out;opacity:0.6}
@keyframes pulse{0%{transform:scale(1);opacity:0.8}70%{transform:scale(2.2);opacity:0}100%{transform:scale(2.6);opacity:0}}
.grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
.card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.small{font-size:13px;color:#9aa7b4}
.center{display:flex;flex-direction:column;align-items:center;gap:8px}
.online{color:var(--green)}.down{color:var(--red)}.maintenance{color:var(--yellow)}.restarting{color:var(--blue)}.updating{color:var(--purple)}
@media(min-width:880px){.grid{grid-template-columns:2fr 1fr}}
</style>
</head>
<body>
  <div class="container">
    <div id="chartArea" class="card" style="display:none">
      <div class="small">Uptime (last 30 days)</div>
      <canvas id="monthlyChart" height="120"></canvas>
    </div>

    <div id="statusCard" class="statusCard" style="margin-top:12px">
      <div id="pulseEl" class="pulse" style="background:#999"></div>
      <div>
        <div id="statusText" style="font-weight:700;font-size:20px">Loadingâ€¦</div>
        <div id="lastInfo" class="small">Loading last incidentâ€¦</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small">Uptime</div>
        <div id="uptimePerc" style="font-weight:700">â€”</div>
      </div>
    </div>

    <div class="grid" style="margin-top:16px">
      <div class="card center">
        <div class="small">24h line (recent checks)</div>
        <canvas id="lineChart" height="160"></canvas>
      </div>
      <div class="card">
        <div class="small">Details</div>
        <div style="margin-top:8px">
          <div class="small">Last incident</div>
          <div id="lastIncident">â€”</div>
        </div>
        <div style="margin-top:8px">
          <div class="small">24h / 7d / 30d</div>
          <div id="u24" style="font-weight:700">â€”</div>
          <div id="u7" style="font-weight:700">â€”</div>
          <div id="u30" style="font-weight:700">â€”</div>
        </div>
        <div style="margin-top:12px"><a href="/login.html" class="small" style="color:#9fb9ff">Admin panel</a></div>
      </div>
    </div>
  </div>

<script>
async function fetchJson(url){ const r = await fetch(url); return r.ok ? r.json() : null; }
function setStatusVisual(status){
  const s = (status||'unknown').toLowerCase();
  const map = { online:'ðŸŸ¢ ONLINE', down:'ðŸ”´ DOWN', maintenance:'ðŸŸ¡ MAINTENANCE', restarting:'ðŸ”µ RESTARTING', updating:'ðŸŸ£ UPDATING' };
  document.getElementById('statusText').textContent = map[s] || status || 'UNKNOWN';
  const colorMap = { online:'#39d353', down:'#ff4d4f', maintenance:'#ffbf47', restarting:'#5ab0ff', updating:'#c07bff' };
  document.getElementById('pulseEl').style.background = colorMap[s] || '#999';
  document.getElementById('pulseEl').style.boxShadow = '0 0 12px '+(colorMap[s]||'#999')+'66';
}

async function refreshAll(){
  const st = await fetchJson('/status.json');
  if (st) setStatusVisual(st.status);
  const months = await fetchJson('/monthly.json');
  if (months) { document.getElementById('chartArea').style.display='block'; drawMonthly(months); document.getElementById('u30').textContent = months.reduce((a,b)=>a+b.uptime,0)/months.length + '%'; }
  const last = await fetchJson('/last-incident');
  document.getElementById('lastIncident').textContent = last ? (last.end_ts ? new Date(last.start_ts).toLocaleString()+' â†’ '+new Date(last.end_ts).toLocaleString() : 'Ongoing since '+new Date(last.start_ts).toLocaleString()) : 'No incidents';
  document.getElementById('u24').textContent = 'See admin'; document.getElementById('u7').textContent = 'See admin';
}

let monthlyChart=null, lineChart=null;
function drawMonthly(data){
  const ctx = document.getElementById('monthlyChart').getContext('2d');
  const labels = data.map(d=>d.day.slice(5));
  const vals = data.map(d=>d.uptime);
  if (monthlyChart) monthlyChart.destroy();
  monthlyChart = new Chart(ctx, { type:'bar', data:{ labels, datasets:[{data:vals, backgroundColor: vals.map(v=> v>=99? '#39d353' : v>=95? '#ffbf47' : '#ff4d4f') }] }, options:{scales:{y:{beginAtZero:true,max:100}}} });
  const ctx2 = document.getElementById('lineChart').getContext('2d');
  const llabels = labels.slice(-24);
  const lvals = vals.slice(-24);
  if (lineChart) lineChart.destroy();
  lineChart = new Chart(ctx2, { type:'line', data:{ labels:llabels, datasets:[{data:lvals, borderColor:'#39d353', fill:true, backgroundColor:'rgba(57,211,83,0.08)'}] }, options:{scales:{y:{beginAtZero:true,max:100}}} });
}

refreshAll(); setInterval(refreshAll, 15000);
</script>
</body>
</html
